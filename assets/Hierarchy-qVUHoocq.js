import{h as A,i as M}from"./resquarify-YluFbuPg.js";import{_ as B,f as P,o as T,c as j,F as q,p as E,a as F,b as S}from"./index-j31-AAIX.js";const C=p=>(E("data-v-37b83f96"),p=p(),F(),p),H=C(()=>S("h3",null,"用Canvas+d3绘制层次关系图",-1)),R=C(()=>S("canvas",{width:"1600",height:"1600"},null,-1)),X={__name:"Hierarchy",setup(p){const _=2*Math.PI;return P(()=>{const m=document.querySelector("canvas"),t=m.getContext("2d"),x="https://s5.ssl.qhres2.com/static/b0695e2dd30daa64.json";let y;(async function(){const a=await(await fetch(x)).json(),n=A(a).sum(e=>1).sort((e,s)=>s.value-e.value),i=M().size([1600,1600]).padding(3)(n);function o(e,s,{fillStyle:f="rgba(0, 0, 0, 0.2)",textColor:v="white"}={}){const d=s.children,{x:u,y:w,r:k}=s;if(e.fillStyle=f,e.beginPath(),e.arc(u,w,k,0,_),e.fill(),d)for(let h=0;h<d.length;h++)o(e,d[h]);else{const h=s.data.name;e.fillStyle=v,e.font="1.5rem Arial",e.textAlign="center",e.fillText(h,u,w)}}o(t,i),y=i.children.map(e=>e.children).flat();const r=m.getBoundingClientRect(),c=r.left,g=r.top;m.addEventListener("mousemove",e=>{const s=e.pageX-c,f=e.pageY-g;I(s*2,f*2)})})(),CanvasRenderingContext2D.prototype.clearCircle=function(a,n,l){t.save(),t.fillStyle="rgba(255, 255, 255, 255)",t.beginPath(),t.arc(a,n,l,0,_),t.fill(),t.restore()};function I(a,n){const l=["rgba(0, 0, 0, 0.5)","rgba(255, 0, 0, 0.5)"];for(let i=0;i<y.length;i++){const{x:o,y:r,r:c,data:{name:g}}=y[i],e=a-o,s=n-r,f=o-c,v=o+c,d=r-c,u=r+c;a<=v&&a>=f&&n<=u&&n>=d&&Math.pow(e,2)+Math.pow(s,2)<Math.pow(c,2)?b(o,r,c,g,l[1]):b(o,r,c,g,l[0])}}function b(a,n,l,i,o){t.clearCircle(a,n,l),t.fillStyle=o,t.beginPath(),t.arc(a,n,l,0,_),t.fill(),t.fillStyle="white",t.font="1.5rem Arial",t.textAlign="center",t.fillText(i,a,n)}}),(m,t)=>(T(),j(q,null,[H,R],64))}},D=B(X,[["__scopeId","data-v-37b83f96"]]);export{D as default};
