function U(n){var e=0,t=n.children,r=t&&t.length;if(!r)e=1;else for(;--r>=0;)e+=t[r].value;n.value=e}function X(){return this.eachAfter(U)}function Y(n){var e=this,t,r=[e],i,u,a;do for(t=r.reverse(),r=[];e=t.pop();)if(n(e),i=e.children,i)for(u=0,a=i.length;u<a;++u)r.push(i[u]);while(r.length);return this}function b(n){for(var e=this,t=[e],r,i;e=t.pop();)if(n(e),r=e.children,r)for(i=r.length-1;i>=0;--i)t.push(r[i]);return this}function B(n){for(var e=this,t=[e],r=[],i,u,a;e=t.pop();)if(r.push(e),i=e.children,i)for(u=0,a=i.length;u<a;++u)t.push(i[u]);for(;e=r.pop();)n(e);return this}function ee(n){return this.eachAfter(function(e){for(var t=+n(e.data)||0,r=e.children,i=r&&r.length;--i>=0;)t+=r[i].value;e.value=t})}function ne(n){return this.eachBefore(function(e){e.children&&e.children.sort(n)})}function te(n){for(var e=this,t=re(e,n),r=[e];e!==t;)e=e.parent,r.push(e);for(var i=r.length;n!==t;)r.splice(i,0,n),n=n.parent;return r}function re(n,e){if(n===e)return n;var t=n.ancestors(),r=e.ancestors(),i=null;for(n=t.pop(),e=r.pop();n===e;)i=n,n=t.pop(),e=r.pop();return i}function ie(){for(var n=this,e=[n];n=n.parent;)e.push(n);return e}function ue(){var n=[];return this.each(function(e){n.push(e)}),n}function ae(){var n=[];return this.eachBefore(function(e){e.children||n.push(e)}),n}function oe(){var n=this,e=[];return n.each(function(t){t!==n&&e.push({source:t.parent,target:t})}),e}function G(n,e){var t=new A(n),r=+n.value&&(t.value=n.value),i,u=[t],a,h,l,o;for(e==null&&(e=le);i=u.pop();)if(r&&(i.value=+i.data.value),(h=e(i.data))&&(o=h.length))for(i.children=new Array(o),l=o-1;l>=0;--l)u.push(a=i.children[l]=new A(h[l])),a.parent=i,a.depth=i.depth+1;return t.eachBefore(fe)}function he(){return G(this).eachBefore(ce)}function le(n){return n.children}function ce(n){n.data=n.data.data}function fe(n){var e=0;do n.height=e;while((n=n.parent)&&n.height<++e)}function A(n){this.data=n,this.depth=this.height=0,this.parent=null}A.prototype=G.prototype={constructor:A,count:X,each:Y,eachAfter:B,eachBefore:b,sum:ee,sort:ne,path:te,ancestors:ie,descendants:ue,leaves:ae,links:oe,copy:he};var se=Array.prototype.slice;function de(n){for(var e=n.length,t,r;e;)r=Math.random()*e--|0,t=n[e],n[e]=n[r],n[r]=t;return n}function ve(n){for(var e=0,t=(n=de(se.call(n))).length,r=[],i,u;e<t;)i=n[e],u&&I(u,i)?++e:(u=xe(r=pe(r,i)),e=0);return u}function pe(n,e){var t,r;if(W(e,n))return[e];for(t=0;t<n.length;++t)if(V(e,n[t])&&W(k(n[t],e),n))return[n[t],e];for(t=0;t<n.length-1;++t)for(r=t+1;r<n.length;++r)if(V(k(n[t],n[r]),e)&&V(k(n[t],e),n[r])&&V(k(n[r],e),n[t])&&W(J(n[t],n[r],e),n))return[n[t],n[r],e];throw new Error}function V(n,e){var t=n.r-e.r,r=e.x-n.x,i=e.y-n.y;return t<0||t*t<r*r+i*i}function I(n,e){var t=n.r-e.r+1e-6,r=e.x-n.x,i=e.y-n.y;return t>0&&t*t>r*r+i*i}function W(n,e){for(var t=0;t<e.length;++t)if(!I(n,e[t]))return!1;return!0}function xe(n){switch(n.length){case 1:return ye(n[0]);case 2:return k(n[0],n[1]);case 3:return J(n[0],n[1],n[2])}}function ye(n){return{x:n.x,y:n.y,r:n.r}}function k(n,e){var t=n.x,r=n.y,i=n.r,u=e.x,a=e.y,h=e.r,l=u-t,o=a-r,f=h-i,c=Math.sqrt(l*l+o*o);return{x:(t+u+l/c*f)/2,y:(r+a+o/c*f)/2,r:(c+i+h)/2}}function J(n,e,t){var r=n.x,i=n.y,u=n.r,a=e.x,h=e.y,l=e.r,o=t.x,f=t.y,c=t.r,y=r-a,v=r-o,p=i-h,d=i-f,s=l-u,g=c-u,_=r*r+i*i-u*u,w=_-a*a-h*h+l*l,M=_-o*o-f*f+c*c,m=v*p-y*d,x=(p*M-d*w)/(m*2)-r,q=(d*s-p*g)/m,C=(v*w-y*M)/(m*2)-i,N=(y*g-v*s)/m,E=q*q+N*N-1,R=2*(u+x*q+C*N),H=x*x+C*C-u*u,D=-(E?(R+Math.sqrt(R*R-4*E*H))/(2*E):H/R);return{x:r+x+q*D,y:i+C+N*D,r:D}}function L(n,e,t){var r=n.x,i=n.y,u=e.r+t.r,a=n.r+t.r,h=e.x-r,l=e.y-i,o=h*h+l*l;if(o){var f=.5+((a*=a)-(u*=u))/(2*o),c=Math.sqrt(Math.max(0,2*u*(a+o)-(a-=o)*a-u*u))/(2*o);t.x=r+f*h+c*l,t.y=i+f*l-c*h}else t.x=r+a,t.y=i}function O(n,e){var t=e.x-n.x,r=e.y-n.y,i=n.r+e.r;return i*i-1e-6>t*t+r*r}function S(n){var e=n._,t=n.next._,r=e.r+t.r,i=(e.x*t.r+t.x*e.r)/r,u=(e.y*t.r+t.y*e.r)/r;return i*i+u*u}function j(n){this._=n,this.next=null,this.previous=null}function ge(n){if(!(i=n.length))return 0;var e,t,r,i,u,a,h,l,o,f,c;if(e=n[0],e.x=0,e.y=0,!(i>1))return e.r;if(t=n[1],e.x=-t.r,t.x=e.r,t.y=0,!(i>2))return e.r+t.r;L(t,e,r=n[2]),e=new j(e),t=new j(t),r=new j(r),e.next=r.previous=t,t.next=e.previous=r,r.next=t.previous=e;e:for(h=3;h<i;++h){L(e._,t._,r=n[h]),r=new j(r),l=t.next,o=e.previous,f=t._.r,c=e._.r;do if(f<=c){if(O(l._,r._)){t=l,e.next=t,t.previous=e,--h;continue e}f+=l._.r,l=l.next}else{if(O(o._,r._)){e=o,e.next=t,t.previous=e,--h;continue e}c+=o._.r,o=o.previous}while(l!==o.next);for(r.previous=e,r.next=t,e.next=t.previous=t=r,u=S(e);(r=r.next)!==t;)(a=S(r))<u&&(e=r,u=a);t=e.next}for(e=[t._],r=t;(r=r.next)!==t;)e.push(r._);for(r=ve(e),h=0;h<i;++h)e=n[h],e.x-=r.x,e.y-=r.y;return r.r}function _e(n){return n==null?null:me(n)}function me(n){if(typeof n!="function")throw new Error;return n}function Z(){return 0}function we(n){return function(){return n}}function Me(n){return Math.sqrt(n.value)}function ke(){var n=null,e=1,t=1,r=Z;function i(u){return u.x=e/2,u.y=t/2,n?u.eachBefore($(n)).eachAfter(z(r,.5)).eachBefore(F(1)):u.eachBefore($(Me)).eachAfter(z(Z,1)).eachAfter(z(r,u.r/Math.min(e,t))).eachBefore(F(Math.min(e,t)/(2*u.r))),u}return i.radius=function(u){return arguments.length?(n=_e(u),i):n},i.size=function(u){return arguments.length?(e=+u[0],t=+u[1],i):[e,t]},i.padding=function(u){return arguments.length?(r=typeof u=="function"?u:we(+u),i):r},i}function $(n){return function(e){e.children||(e.r=Math.max(0,+n(e)||0))}}function z(n,e){return function(t){if(r=t.children){var r,i,u=r.length,a=n(t)*e||0,h;if(a)for(i=0;i<u;++i)r[i].r+=a;if(h=ge(r),a)for(i=0;i<u;++i)r[i].r-=a;t.r=h+a}}}function F(n){return function(e){var t=e.parent;e.r*=n,t&&(e.x=t.x+n*e.x,e.y=t.y+n*e.y)}}function K(n,e,t,r,i){for(var u=n.children,a,h=-1,l=u.length,o=n.value&&(r-e)/n.value;++h<l;)a=u[h],a.y0=t,a.y1=i,a.x0=e,a.x1=e+=a.value*o}Object.create(A.prototype);function P(n,e,t,r,i){for(var u=n.children,a,h=-1,l=u.length,o=n.value&&(i-t)/n.value;++h<l;)a=u[h],a.x0=e,a.x1=r,a.y0=t,a.y1=t+=a.value*o}var Q=(1+Math.sqrt(5))/2;function T(n,e,t,r,i,u){for(var a=[],h=e.children,l,o,f=0,c=0,y=h.length,v,p,d=e.value,s,g,_,w,M,m,x;f<y;){v=i-t,p=u-r;do s=h[c++].value;while(!s&&c<y);for(g=_=s,m=Math.max(p/v,v/p)/(d*n),x=s*s*m,M=Math.max(_/x,x/g);c<y;++c){if(s+=o=h[c].value,o<g&&(g=o),o>_&&(_=o),x=s*s*m,w=Math.max(_/x,x/g),w>M){s-=o;break}M=w}a.push(l={value:s,dice:v<p,children:h.slice(f,c)}),l.dice?K(l,t,r,i,d?r+=p*s/d:u):P(l,t,r,d?t+=v*s/d:i,u),d-=s,f=c}return a}(function n(e){function t(r,i,u,a,h){T(e,r,i,u,a,h)}return t.ratio=function(r){return n((r=+r)>1?r:1)},t})(Q);(function n(e){function t(r,i,u,a,h){if((l=r._squarify)&&l.ratio===e)for(var l,o,f,c,y=-1,v,p=l.length,d=r.value;++y<p;){for(o=l[y],f=o.children,c=o.value=0,v=f.length;c<v;++c)o.value+=f[c].value;o.dice?K(o,i,u,a,u+=(h-u)*o.value/d):P(o,i,u,i+=(a-i)*o.value/d,h),d-=o.value}else r._squarify=l=T(e,r,i,u,a,h),l.ratio=e}return t.ratio=function(r){return n((r=+r)>1?r:1)},t})(Q);export{G as h,ke as i};
